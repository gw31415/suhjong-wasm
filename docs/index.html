<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<title>Suhjong Highest Scores</title>
	<meta name="description"
		content="A web application to calculate the highest score from a hand in the card game: Suhjong">
	<meta name="author" content="Amadeus_vn">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="https://fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">
	<link rel="icon" type="image/png" href="favicon.png">
	<link rel="apple-touch-icon" href="favicon.png">
</head>
<style>
	/* skeleton.css and normalize.css for reference */
	*,
	*:before,
	*:after {
		-webkit-box-sizing: border-box;
		box-sizing: border-box
	}

	html {
		font-size: 120%;
		-ms-text-size-adjust: 100%;
		-webkit-text-size-adjust: 100%;
		font-family: "Raleway", "HelveticaNeue", "Helvetica Neue", Helvetica, Arial, sans-serif;
		font-weight: 400;
	}

	body {
		font-size: 1.5em;
		/* currently ems cause chrome bug misinterpreting rems on body element */
		line-height: 1.6;
		color: #222;
		margin: 0;
	}

	h1 {
		margin: .5rem 0;
		font-weight: 300;
		font-size: 1.2rem;
		line-height: 1.2;
	}

	input {
		border: solid 0;
		outline: none;
		color: inherit;
		font: inherit;
		margin: 0;
	}

	ul {
		list-style-type: square;
		font-size: 90%;
		display: inline-block;
	}

	li {
		margin-bottom: 1rem;
	}

	body,
	input {
		text-align: center;
		max-width: 100%;
	}

	li,
	h1 {
		text-align: left;
	}

	#container {
		width: 100%;
		max-width: 960px;
		margin: 0 auto;
		padding: 0 20px;
		display: flex;
		justify-content: center;
		min-height: 100vh;
		min-height: 100dvh
	}

	@media (max-height: calc(100vh + 1px)) {
		#container {
			align-items: center;
		}
	}

	@media (min-width: 400px) {
		#container {
			width: 85%;
			padding: 0;
		}
	}

	@media (min-width: 550px) {
		#container {
			width: 80%;
		}

		html {
			font-size: 150%
		}

		h1 {
			font-size: 1.5rem;
		}
	}
</style>

<body>
	<div id="container">
		<div style="width:100%">
			<input maxlength="5" pattern="\d{5}" inputmode="numeric" placeholder="Input 5 numbers...." id="input" />
			<div id="res" style="display:none">
				<h1>The Highest Score is:</h1>
				<div style="font-size:100px" id="score"></div>
				<div id="eqn-sec" style="display:none">
					<h1>Available equations:</h1>
					<div>
						<ul id="eqns" />
					</div>
				</div>
			</div>
		</div>
	</div>
</body>
<script type="module">
	import init, {best_equations, calc_equation} from './pkg/suhjong_wasm.js'

	const input = document.getElementById('input')

	const isPC = (() => {
		const ua = navigator.userAgent
		for (const d of [
			'Mobile', 'Android', 'iPad', 'Windows Phone'
		]) {
			if (ua.includes(d)) return false
		}
		return true
	})()

	window.onload = () => {
		if (isPC) input.focus()
	}
	async function set_score(score) {
		document.getElementById('score').textContent = score.toString()
	}
	async function set_eqns(eqns) {
		if (eqns.length === 0) {
			document.getElementById("eqn-sec").style.display = "none"
		}
		else {
			const ulist = document.getElementById('eqns')
			ulist.replaceChildren.apply(ulist, eqns.map(eqn => {
				let display = eqn
				if (
					(eqn[3] === '*' || eqn[3] === '/') &&
					(eqn[1] === '+' || eqn[1] === '-')
				) {
					display = '(' + eqn.slice(0, 3) + ')' + eqn.slice(3)
				}
				display = display.replaceAll('*', 'Ã—')
				display = display.replaceAll(/\D/g, " $& ")
				const li = document.createElement('li')
				li.textContent = display
				return li
			}))
			document.getElementById("eqn-sec").style.display = "block"
		}
	}

	(async () => {
		await init()
		input.addEventListener('input', async it => {
			const cards = input.value
			if (cards.length === 5) {
				if (!isPC) input.blur()
				if (!/^\d{5}$/.test(cards)) return
				const output = best_equations(cards[0], cards[1], cards[2], cards[3], cards[4])
				if (output.includes("=")) {
					const eqns = output.split(";")
					await Promise.all([
						set_score(calc_equation(eqns[0])),
						set_eqns(eqns),
					])
				} else {
					await Promise.all([
						set_score(0),
						set_eqns([]),
					])
				}
				document.getElementById("res").style.display = "block"
			} else {
				document.getElementById("res").style.display = "none"
			}
		})
	})()
</script>

</html>
